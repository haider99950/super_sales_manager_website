<!-- templates/pricing.html -->
{% extends "base.html" %}

{% block content %}
<div class="flex items-center justify-center min-h-screen -mt-16">
    <div class="w-full max-w-4xl bg-white dark:bg-gray-800 shadow-xl rounded-2xl p-8 md:p-10 text-center">
        <h2 class="text-4xl font-bold text-gray-900 dark:text-white mb-8">Choose Your Plan</h2>
        <div class="flex flex-col md:flex-row justify-center gap-8">
            <!-- Monthly Plan Card -->
            <div class="flex-1 max-w-sm bg-gray-100 dark:bg-gray-700 rounded-xl shadow-lg p-6 flex flex-col justify-between transform transition-transform hover:scale-105 duration-300">
                <div>
                    <h3 class="text-2xl font-bold text-indigo-600 dark:text-indigo-400 mb-4">Monthly Plan</h3>
                    <p class="text-4xl font-extrabold text-gray-900 dark:text-white mb-4">$8<span class="text-lg font-normal text-gray-500 dark:text-gray-400">/month</span></p>
                    <ul class="text-left text-gray-700 dark:text-gray-300 space-y-2 mb-6">
                        <li class="flex items-center"><svg class="w-5 h-5 text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-10.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>All free features</li>
                        <li class="flex items-center"><svg class="w-5 h-5 text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-10.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>Enhanced reports</li>
                        <li class="flex items-center"><svg class="w-5 h-5 text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-10.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>Priority support</li>
                    </ul>
                </div>
                <form id="monthly-form">
                    <input type="hidden" name="price_id" value="{{ STRIPE_MONTHLY_PLAN_ID }}">
                    <button type="submit" class="w-full px-4 py-3 bg-indigo-600 text-white rounded-lg font-bold text-lg hover:bg-indigo-700 transition-colors duration-300">
                        Activate Monthly
                    </button>
                </form>
            </div>

            <!-- Annual Plan Card -->
            <div class="flex-1 max-w-sm bg-gray-100 dark:bg-gray-700 rounded-xl shadow-lg p-6 flex flex-col justify-between transform transition-transform hover:scale-105 duration-300">
                <div>
                    <h3 class="text-2xl font-bold text-indigo-600 dark:text-indigo-400 mb-4">Annual Plan</h3>
                    <p class="text-4xl font-extrabold text-gray-900 dark:text-white mb-4">$80<span class="text-lg font-normal text-gray-500 dark:text-gray-400">/year</span></p>
                    <ul class="text-left text-gray-700 dark:text-gray-300 space-y-2 mb-6">
                        <li class="flex items-center"><svg class="w-5 h-5 text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-10.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>All free features</li>
                        <li class="flex items-center"><svg class="w-5 h-5 text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-10.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>Enhanced reports</li>
                        <li class="flex items-center"><svg class="w-5 h-5 text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-10.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>Priority support</li>
                        <li class="flex items-center"><svg class="w-5 h-5 text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-10.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>20% discount</li>
                    </ul>
                </div>
                <form id="annual-form">
                    <input type="hidden" name="price_id" value="{{ STRIPE_ANNUAL_PLAN_ID }}">
                    <button type="submit" class="w-full px-4 py-3 bg-indigo-600 text-white rounded-lg font-bold text-lg hover:bg-indigo-700 transition-colors duration-300">
                        Activate Annually
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<script src="https://js.stripe.com/v3/"></script>
<script>
    // Note: The Stripe publishable key is hardcoded here for simplicity. In a real-world app,
    // it's better to pass this from the backend.
    const stripe = Stripe('pk_test_51RuD7eRwbpHqliC7bJ17Gq6YF0t5oO0K3K0T9B3vSgUuJbW7qN2R2vC5yA4l6Q7lO3K6oF0f2yB7H8I3v4L3K3b2w004x3y');

    document.getElementById('monthly-form').addEventListener('submit', function(e) {
        e.preventDefault();
        const priceId = this.querySelector('input[name="price_id"]').value;
        createCheckoutSession(priceId);
    });

    document.getElementById('annual-form').addEventListener('submit', function(e) {
        e.preventDefault();
        const priceId = this.querySelector('input[name="price_id"]').value;
        createCheckoutSession(priceId);
    });

    async function createCheckoutSession(priceId) {
        const response = await fetch("{{ url_for('create_checkout_session') }}", {
            method: "POST",
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: new URLSearchParams({
                'price_id': priceId
            }),
        });

        // Check for a redirect response from the server.
        // This happens if the user is not authenticated due to the @login_required decorator.
        if (response.redirected) {
            window.location.href = response.url;
            return;
        }

        const data = await response.json();
        if (data.id) {
            stripe.redirectToCheckout({ sessionId: data.id });
        } else {
            console.error("Error creating checkout session:", data.error);
            // Instead of an alert, you might show a custom modal or a flash message
            // in a more advanced application.
            alert("An error occurred. Please try again.");
        }
    }
</script>
{% endblock %}
